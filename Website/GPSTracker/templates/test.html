{% extends "base.html" %}
{% load static %}
{% load geojson_tags %}
<!-- Head embed -->
{% block head %}
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>OpenLayers: Vector Features</title>
    <link rel="stylesheet" href="/static/css/mapstyle.css" type="text/css">
    <script src="http://www.openlayers.org/api/OpenLayers.js"></script>
    <script onload="init()"type="text/javascript">
        var map, maplayer, stopMarkerLayer, routeLayer;
        var pCount = 0;
        var routeByID = {};
        var stopByID = {};
            stopByID.length = 0;
        var size = new OpenLayers.Size(21,21);
        var icon = new OpenLayers.Icon('/static/images/stopMarker.ico',size);


        {% for ShuttleRoute in routes %}
        routeByID[{{ShuttleRoute.id}}] = {
            name: "{{ShuttleRoute.name}}",
            //TODO fix.
            polyline: "{{ShuttleRoute.mpoly}}"
        };
        {% endfor %}

        function drawStops(){

        {% for RouteStop in stops %}
        stopByID[{{RouteStop.id}}] = {
            name: "{{RouteStop.name}}",
            lat: {{RouteStop.mpoint.y}},
            lng: {{RouteStop.mpoint.x}},
        };
        stopByID.length += 1;
        console.log("length: " + stopByID.length);
        {% endfor %}
        }

        function init(){
            map = new OpenLayers.Map('map');
            maplayer = new OpenLayers.Layer.OSM("Simple OSM Map");
            map.addLayer(maplayer);
            stopMarkerLayer = new OpenLayers.Layer.Markers("StopMarkers");
            map.addLayer(stopMarkerLayer);
            map.setCenter(
                new OpenLayers.LonLat(-83.18032, 35.30872).transform(
                new OpenLayers.Projection("EPSG:4326"),
                map.getProjectionObject()),16);
            drawStops();

            for(var i = 1; i <= stopByID.length; i++) {
            console.log("Adding: " + stopByID[i].name);
            //Have to clone our icon if used more than once.
            if(pCount == 0){ 
            stopMarkerLayer.addMarker(new OpenLayers.Marker(
                new OpenLayers.LonLat(stopByID[i].lng,
                                      stopByID[i].lat).transform(
                                      new OpenLayers.Projection("EPSG:4326"),
                                      map.getProjectionObject()),icon));
                pCount = 1;
            } else {
             stopMarkerLayer.addMarker(new OpenLayers.Marker(
                new OpenLayers.LonLat(stopByID[i].lng,
                                      stopByID[i].lat).transform(
                                      new OpenLayers.Projection("EPSG:4326"),
                                      map.getProjectionObject()),icon.clone()));
            }
            }
            //add routes
            //routeLayer = new OpenLayers.Feature.Vector 
        }            
    </script>                                                   
{% endblock %}
<!-- Content override -->
{% block content %}
<!-- Nasty, but we have to do it to load the map. -->
<body onload="init()"/>
<div id="map" style="height:790px"></div>
{% endblock %}
{% for ShuttleRoute in routes %}
routeByID[{{ShuttleRoute.id}}] = {
    name: "{{ShuttleRoute.name}}",
    polyline: {{ShuttleRoute.mpoly}}
};
{% endfor %}

<!-- Sidebar override -->
{% block sidebar %}
    <ul id="side-menu">
        <div class="first">
        <li class="first">Routes
            <ul id="first2">
                <li class="first"><a onClick="toggleRoute(0);">All-Campus</a></li>
                <li class="first"><a onClick="toggleRoute(1);">Village Express</a></li>
                <li class="first"><a onClick="toggleRoute(2);">HHS Express</a></li>
                <li class="first"><a onClick="toggleRoute(3);">Off-Campus North</a></li>
                <li class="first"><a onClick="toggleRoute(4);">Off-Campus South</a></li>
            </ul>
        </li>
        </div>
        <div class = "last">
        <li class="last">Stops
            <ul>
                <select class="content" size="20">
                    <option onClick="bounceMarker(0);" value="1"> N. Baseball</option>
                    <option onClick="bounceMarker(1);" value="2"> S. Baseball</option>
                    <option onClick="bounceMarker(2);" value="3"> Ramsey</option>
                    <option onClick="bounceMarker(3);" value="4"> Field House</option>
                    <option onClick="bounceMarker(4);" value="5"> Bardo Arts Center</option>
                    <option onClick="bounceMarker(5);" value="6"> Dining Hall</option>
                    <option onClick="bounceMarker(6);" value="7"> Walker</option>
                    <option onClick="bounceMarker(7);" value="8"> Village</option>
                    <option onClick="bounceMarker(8);" value="9"> Norton</option>
                    <option onClick="bounceMarker(9);" value="10"> UC</option>
                    <option onClick="bounceMarker(10);" value="11"> Library</option>
                    <option onClick="bounceMarker(11);" value="12"> Moore</option>
                    <option onClick="bounceMarker(12);" value="13"> Reynolds</option>
                    <option onClick="bounceMarker(13);" value="14"> McKee</option>
                    <option onClick="bounceMarker(14);" value="15"> Albright/Benton</option>
                    <option onClick="bounceMarker(15);" value="16"> Harrill</option>
                    <option onClick="bounceMarker(16);" value="17"> Central</option>
                    <option onClick="bounceMarker(17);" value="18"> OneStop</option>
                    <option onClick="bounceMarker(18);" value="19"> Coulter</option>
                    <option onClick="bounceMarker(19);" value="20"> Kimmell</option>
                </select>
            </ul>
            <button type="button" onClick="clearStopMarkers();">Clear Markers</button>
        </li>
        </div>
    </ul>
{% endblock %}
